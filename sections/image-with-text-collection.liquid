{% liquid
  assign current_handle = collection.handle
  assign show_block = false
  assign active_block = nil
  for block in section.blocks
    if block.settings.collection != blank and block.settings.collection == current_handle
      assign active_block = block
      assign show_block = true
      break
    endif
  endfor
  unless show_block
    assign active_block = section.settings
  endunless

  assign animation_effect = settings.animations
  assign animated = false
  if animation_effect != 'none'
    assign animated = true
    if section.settings.animations != 'inherit'
      assign animation_effect = section.settings.animations
    endif
  endif

  assign container = section.settings.container
  if container == 'w-full'
    assign container = 'container-full'
  endif

  assign image_animation = active_block.image_animation
  assign heading_size = active_block.text_size | replace: 'small', 'h3' | replace: 'medium', 'h2' | replace: 'large', 'h1'
  assign subtext_size = active_block.text_size | replace: 'small', 'h6' | replace: 'medium', 'h6' | replace: 'large', 'h5'

  assign image_wrapper_class = 'm-image-with-text__image-wrapper' | append: ' m-image-with-text--' | append: active_block.layout
  if active_block.hover_effect
    assign image_wrapper_class = image_wrapper_class | append: ' m-scroll-trigger animate--' | append: animation_effect
  endif

  if active_block.image_2 != blank
    assign image_wrapper_class = image_wrapper_class | append: ' m-image-with-text--multiple'
    if active_block.image_overlap
      assign image_wrapper_class = image_wrapper_class | append: ' m-image-with-text--layer'
    endif
  endif

  if active_block.show_image_reverse
    assign image_wrapper_class = image_wrapper_class | append: ' m-image-with-text--reverse'
  endif

  if image_animation == 'move-up-down'
    assign image_wrapper_class = image_wrapper_class | append: ' m-image-with-text--move-up-down'
  endif
%}

<!-- HTML Output Same as Original, Replace 'section.settings.' with 'active_block.' Where Needed -->

{% schema %}
{
  "name": "Image with text by collection",
  "settings": [
    {
      "type": "paragraph",
      "content": "This section will show default data if no collection-specific block is matched."
    },
    {
      "type": "text",
      "id": "title",
      "label": "Default heading"
    },
    {
      "type": "textarea",
      "id": "sub_title",
      "label": "Default subheading"
    },
    {
      "type": "richtext",
      "id": "text",
      "label": "Default text"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Default image"
    },
    {
      "type": "image_picker",
      "id": "image_2",
      "label": "Default second image"
    },
    {
      "type": "url",
      "id": "link",
      "label": "Default image link"
    },
    {
      "type": "url",
      "id": "link_2",
      "label": "Default second image link"
    }
  ],
  "blocks": [
    {
      "type": "collection_content",
      "name": "Collection content block",
      "settings": [
        {
          "type": "collection",
          "id": "collection",
          "label": "Choose collection"
        },
        {
          "type": "text",
          "id": "title",
          "label": "Heading"
        },
        {
          "type": "textarea",
          "id": "sub_title",
          "label": "Subheading"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Text"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "image_picker",
          "id": "image_2",
          "label": "Second image"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Image link"
        },
        {
          "type": "url",
          "id": "link_2",
          "label": "Second image link"
        },
        {
          "type": "select",
          "id": "layout",
          "label": "Image alignment",
          "default": "left",
          "options": [
            { "value": "left", "label": "Left" },
            { "value": "right", "label": "Right" }
          ]
        },
        {
          "type": "checkbox",
          "id": "image_overlap",
          "label": "Enable image overlap"
        },
        {
          "type": "checkbox",
          "id": "show_image_reverse",
          "label": "Reverse image"
        },
        {
          "type": "checkbox",
          "id": "hover_effect",
          "label": "Enable hover effect"
        },
        {
          "type": "select",
          "id": "text_size",
          "label": "Text size",
          "default": "medium",
          "options": [
            { "value": "small", "label": "Small" },
            { "value": "medium", "label": "Medium" },
            { "value": "large", "label": "Large" }
          ]
        },
        {
          "type": "select",
          "id": "image_animation",
          "label": "Image animation",
          "default": "none",
          "options": [
            { "value": "none", "label": "None" },
            { "value": "parallax", "label": "Parallax" },
            { "value": "move-up-down", "label": "Move up/down" }
          ]
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Image with text by collection",
      "category": "Image"
    }
  ]
}
{% endschema %}