{{ 'swiper-bundle.min.css' | asset_url | stylesheet_tag }}
{{ 'apex-theme-product-page.css' | asset_url | stylesheet_tag }}
{%- style -%}
  .custom-product-page {
    background-color: {{ section.settings.background_color }};
    padding-top: {{ section.settings.padding_top }}px;
    padding-bottom: {{ section.settings.padding_bottom }}px;
  }
{%- endstyle -%}

{% assign product = section.settings.product %}
<div class="custom-product-page">
  <div class="rs-container">
    <div class="rs-row">
      <div class="product__slider-wrapper">
        <div class="sticky">
          <div id="product__slider">
            <div class="swiper thumb-slider">
              <div class="swiper-wrapper">
                {% for image in product.images %}
                  <div class="swiper-slide thumb-item">
                    <img src="{{ image | img_url: 'master' }}">
                  </div>
                {% endfor %}
              </div>
            </div>
            <div class="swiper main-slider">
              <div class="swiper-wrapper">
                {% for image in product.images %}
                  <div class="swiper-slide main-item">
                    <img src="{{ image | img_url: 'master' }}">
                  </div>
                {% endfor %}
              </div>
              <div class="button-prev">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 18 18"
                  fill="none">
                  <path d="M6 14.9498L7.075 13.8998L2.875 9.69981H18V8.19981H2.875L7.1 3.9748L6.025 2.9248L0 8.94981L6 14.9498Z" fill="black" />
                </svg>
              </div>
              <div class="button-next">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="18"
                  height="18"
                  viewBox="0 0 18 18"
                  fill="none">
                  <path d="M12 14.9498L10.925 13.8998L15.125 9.69981H0V8.19981H15.125L10.9 3.9748L11.975 2.9248L18 8.94981L12 14.9498Z" fill="black" />
                </svg>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="product-info-content">
        {% for block in section.blocks %}
          {% case block.type %}
            {% when 'review' %}
              <a href="#looxReviews">
                <div class="prouduct-review">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    xmlns:xlink="http://www.w3.org/1999/xlink"
                    xmlns:serif="http://www.serif.com/"
                    width="100%"
                    height="100%"
                    viewBox="0 0 881 130"
                    version="1.1"
                    xml:space="preserve"
                    style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
                    <g transform="matrix(1,0,0,1,-634.728,-382.568)">
                      <path d="M702.68,382.568L718.721,431.938L770.632,431.938L728.635,462.45L744.677,511.82L702.68,481.308L660.683,511.82L676.724,462.45L634.728,431.938L686.639,431.938L702.68,382.568Z" style="fill:rgb(255,216,0);" />
                    </g>
                    <g transform="matrix(1,0,0,1,-447.914,-382.568)">
                      <path d="M702.68,382.568L718.721,431.938L770.632,431.938L728.635,462.45L744.677,511.82L702.68,481.308L660.683,511.82L676.724,462.45L634.728,431.938L686.639,431.938L702.68,382.568Z" style="fill:rgb(255,216,0);" />
                    </g>
                    <g transform="matrix(1,0,0,1,-261.961,-382.568)">
                      <path d="M702.68,382.568L718.721,431.938L770.632,431.938L728.635,462.45L744.677,511.82L702.68,481.308L660.683,511.82L676.724,462.45L634.728,431.938L686.639,431.938L702.68,382.568Z" style="fill:rgb(255,216,0);" />
                    </g>
                    <g transform="matrix(1,0,0,1,-76.0238,-382.568)">
                      <path d="M702.68,382.568L718.721,431.938L770.632,431.938L728.635,462.45L744.677,511.82L702.68,481.308L660.683,511.82L676.724,462.45L634.728,431.938L686.639,431.938L702.68,382.568Z" style="fill:rgb(255,216,0);" />
                    </g>
                    <g transform="matrix(1,0,0,1,109.853,-382.568)">
                      <path d="M702.68,382.568L718.721,431.938L770.632,431.938L728.635,462.45L744.677,511.82L702.68,481.308L660.683,511.82L676.724,462.45L634.728,431.938L686.639,431.938L702.68,382.568Z" style="fill:rgb(255,216,0);" />
                    </g>
                  </svg>

                  <span>
                    {{ block.settings.p }}</span>
                </div>
              </a>
            {% when 'title' %}
              <h2 class="rs-product-title" style="
                  color: {{ block.settings.title_color |  default: '#1c1c1c' }};
                  font-size: {{ block.settings.title_font_size | default: 22 }}px;
                ">
                {{ product.title }}
              </h2>

            {% when 'subtitle' %}
              <h4 class="rs-product-subtitle" style="                  
                  font-size: clamp(14px, {{ block.settings.subtitle_font_size | default: 16 }}px, 20px);
                ">
                {{ block.settings.subtitle }}
              </h4>
            {% when 'ratings' %}
              <div class="rs-product-rating"></div>
              <div class="rs-liked">
                <div class="liked-img">
                  {% if block.settings.likeImg1 != blank %}
                    <img src="{{ block.settings.likeImg1 |  img_url: 'small' }}" alt="">
                  {% endif %}
                  {% if block.settings.likeImg2 != blank %}
                    <img src="{{ block.settings.likeImg2 |  img_url: 'small' }}" alt="">
                  {% endif %}
                  {% if block.settings.likeImg3 != blank %}
                    <img src="{{ block.settings.likeImg3 |  img_url: 'small' }}" alt="">
                  {% endif %}
                </div>
                <span class="like-count">{{ block.settings.likecount }}</span>
                <p class="like-info">{{ block.settings.likeinfo }}</p>
              </div>
              {% if product.tags contains 'HOHE NACHFRAGE' %}
                <div class="rs-demand-badge">
                  <span class="demand-badge">{{ block.settings.demandBadge }}</span>
                  <span class="demand-text">{{ block.settings.demandText }}</span>
                </div>
              {% endif %}
            {% when 'price' %}
              <div class="rs-price">
                <span class="current-price">{{ product.selected_or_first_available_variant.price | money }}</span>
                {% if product.selected_or_first_available_variant.price < product.compare_at_price %}
                  <span class="compare-price">{{ product.compare_at_price | money }}</span>
                {% endif %}
              </div>
            {% when 'viewerStockCount' %}
              {% render 'viewer-stock-count'
                , block: block
                , produc: product %}
            {% when 'featurelist_header' %}
              <p class="feature-header" style="                  
                  font-size: {{ block.settings.featurelist_header_size |  default: 14}}px;
                ">
                {% if block.settings.featureHeader != blank %}
                  <img src="https://cdn.shopify.com/s/files/1/0018/5329/2643/files/feature-icon.jpg?v=1739338221" alt="Feature Icon">
                {% endif %}
                {{ block.settings.featureHeader }}
              </p>
            {% when 'featurelist_item' %}
              <div class="product-feature-item" style="
                  color:{{ block.settings.featurelist_item_color |  default: '#000' }};
                  font-size: {{ block.settings.featurelist_item_size |  default: 14}}px;
                ">
                {% if block.settings.featurelist_item != blank %}
                  <img src="https://cdn.shopify.com/s/files/1/0018/5329/2643/files/ok-icon.png?v=1739338478" alt="Feature Icon">
                {% endif %}
                {{ block.settings.featurelist_item }}
              </div>
            {% when 'addBtn' %}
              <div class="rs-addBtn">
                <button class="rs-add-to-cart" data-id="{{ product.selected_or_first_available_variant.id }}">
                  {{ block.settings.btn_text }}
                </button>
              </div>
            {% when 'paymentIcon' %}
              <div class="rs-payment-icons">
                {%- render 'payment-icons.liquid' -%}
              </div>

            {% when 'productInfo' %}
              <div class="rs-product-info">
                <div class="info-card">
                  {% if block.settings.info_text_1 != blank %}
                    <img
                      src="{{ block.settings.info_img_1 |  img_url: 'medium' }}"
                      alt=""
                      class="info-icon">
                  {% endif %}
                  <p class="product-info-text">{{ block.settings.info_text_1 }}</p>
                </div>
                <div class="info-card">
                  {% if block.settings.info_text_2 != blank %}
                    <img
                      src="{{ block.settings.info_img_2 |  img_url: 'medium' }}"
                      alt=""
                      class="info-icon">
                  {% endif %}
                  <p class="product-info-text">{{ block.settings.info_text_2 }}</p>
                </div>
                <div class="info-card">
                  {% if block.settings.info_text_3 != blank %}
                    <img
                      src="{{ block.settings.info_img_3 |  img_url: 'medium' }}"
                      alt=""
                      class="info-icon">
                  {% endif %}
                  <p class="product-info-text">{{ block.settings.info_text_3 }}</p>
                </div>
              </div>
          {% endcase %}
        {% endfor %}
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
{% schema %}
  {
    "name": "APEX Product Infos old",

    "settings": [
      {
        "type": "product",
        "id": "product",
        "label": "Select Product"
      }, {
        "type": "color",
        "id": "background_color",
        "label": "Background Color"
      }, {
        "type": "range",
        "id": "padding_top",
        "label": "Padding Top",
        "default": 0,
        "min": 0,
        "max": 100,
        "step": 1,
        "unit": "px"
      }, {
        "type": "range",
        "id": "padding_bottom",
        "label": "Padding Bottom",
        "default": 0,
        "min": 0,
        "max": 100,
        "step": 1,
        "unit": "px"
      }
    ],
    "blocks": [
      {
        "type": "title",
        "name": "title Block",
        "settings": [
          {
            "type": "color",
            "id": "title_color",
            "label": "Title Color",
            "default": "#1c1c1c"
          }, {
            "type": "range",
            "id": "title_font_size",
            "label": "Title Font Size",
            "default": 22,
            "min": 10,
            "max": 100,
            "step": 1,
            "unit": "px"
          }
        ]
      },
      {
        "type": "review",
        "name": "Review Count",
        "settings": [
          {
            "type": "text",
            "id": "p",
            "label": "Put the review count",
            "default": "4.9/5 Sternen"
          }
        ]
      },
      {
        "type": "subtitle",
        "name": "Subtitle Block",
        "settings": [
          {
            "type": "text",
            "id": "subtitle",
            "label": "Add Sub Title",
            "default": "Effortless cutting thanks to the highest quality!"
          }, {
            "type": "range",
            "id": "subtitle_font_size",
            "label": "Subtitle Font Size",
            "default": 16,
            "min": 10,
            "max": 100,
            "step": 1,
            "unit": "px"
          }
        ]
      },
      {
        "type": "ratings",
        "name": "Ratings Block",
        "settings": [
          {
            "type": "image_picker",
            "id": "likeImg1",
            "label": "Like Image 1"
          },
          {
            "type": "image_picker",
            "id": "likeImg2",
            "label": "Like Image 2"
          },
          {
            "type": "image_picker",
            "id": "likeImg3",
            "label": "Like Image 3"
          },
          {
            "type": "text",
            "id": "likecount",
            "label": "Like Count",
            "default": "1,532+ people"
          }, {
            "type": "text",
            "id": "likeinfo",
            "label": "Like Info",
            "default": "are already convinced by oursharp blades!"
          }, {
            "type": "text",
            "id": "demandBadge",
            "label": "Demand Badge",
            "default": "High demand"
          }, {
            "type": "text",
            "id": "demandText",
            "label": "Demand Text",
            "default": "Many people have viewed this product in the last 24 hours"
          }
        ]
      }, {
        "type": "price",
        "name": "Price Block",
        "settings": []
      }, {
        "type": "viewerStockCount",
        "name": "View and Stock Count",
        "settings": [
          {
            "type": "range",
            "id": "viewer_count_font_size",
            "min": 1,
            "max": 100,
            "step": 1,
            "unit": "px",
            "label": "Font size",
            "default": 16
          },
          {
            "type": "text",
            "id": "view_main_text_1",
            "label": "View Main Text",
            "default": "people"
          },
          {
            "type": "text",
            "id": "view_main_text_2",
            "label": "View Main Text",
            "default": "are currently looking at this product"
          },
          {
            "type": "color",
            "id": "viewer_text_color",
            "label": "Color"
          }, {
            "type": "range",
            "id": "viewer_margin_top",
            "min": 1,
            "max": 100,
            "step": 1,
            "unit": "px",
            "label": "View Count Margin Top",
            "default": 10
          }, {
            "type": "range",
            "id": "viewer_margin_bottom",
            "min": 1,
            "max": 100,
            "step": 1,
            "unit": "px",
            "label": "View Count Margin Bottom",
            "default": 10
          }, {
            "type": "color",
            "id": "viewer_count_text_color",
            "label": "Color"
          }, {
            "type": "range",
            "id": "viewer_margin_top_mobile",
            "min": 1,
            "max": 100,
            "step": 1,
            "unit": "px",
            "label": "View Count Margin Top (Mobile)",
            "default": 1
          }, {
            "type": "range",
            "id": "viewer_margin_bottom_mobile",
            "min": 1,
            "max": 100,
            "step": 1,
            "unit": "px",
            "label": "View Count Margin Bottom (Mobile)",
            "default": 1
          }, {
            "type": "range",
            "id": "product_count_font_size",
            "min": 1,
            "max": 100,
            "step": 1,
            "unit": "px",
            "label": "Font size",
            "default": 16
          }, {
            "type": "text",
            "id": "product_main_text_1",
            "label": "Product Main Text ",
            "default": "Only"
          }, {
            "type": "text",
            "id": "product_main_text_2",
            "label": "Product Main Text",
            "default": "left in stock"
          }, {
            "type": "color",
            "id": "product_text_color",
            "label": "Color"
          }, {
            "type": "color",
            "id": "product_count_text_color",
            "label": "Count Text Color"
          }, {
            "type": "range",
            "id": "product_margin_top",
            "min": 1,
            "max": 100,
            "step": 1,
            "unit": "px",
            "label": "Product Count Margin Top",
            "default": 10
          }, {
            "type": "range",
            "id": "product_margin_bottom",
            "min": 1,
            "max": 100,
            "step": 1,
            "unit": "px",
            "label": "Product Count Margin Bottom",
            "default": 10
          }, {
            "type": "number",
            "id": "viewer_count_time",
            "label": "Add Viewer Update Time Delay (milliseconds )",
            "default": 2500
          }, {
            "type": "number",
            "id": "stock_count_time",
            "label": "Add Stock Update Time Delay (milliseconds )",
            "default": 5000
          }, {
            "type": "range",
            "id": "p_margin_mobile_top",
            "min": 1,
            "max": 100,
            "step": 1,
            "unit": "px",
            "label": "Product Count Margin Top (Mobile)",
            "default": 1
          }, {
            "type": "range",
            "id": "p_margin_mobile_bottom",
            "min": 1,
            "max": 100,
            "step": 1,
            "unit": "px",
            "label": "Product Count Margin Bottom (Mobile)",
            "default": 1
          }
        ]
      }, {
        "type": "featurelist_header",
        "name": "Feature List Header",
        "settings": [
          {
            "type": "text",
            "id": "featureHeader",
            "label": "Feature Header",
            "default": "30-day satisfaction guarantee"
          }, {
            "type": "color",
            "id": "featurelist_header_color",
            "label": "Feature List Header Color",
            "default": "#000"
          }, {
            "type": "range",
            "id": "featurelist_header_size",
            "label": "Feature List Header Size",
            "default": 14,
            "min": 10,
            "max": 100,
            "step": 1,
            "unit": "px"
          }
        ]
      }, {
        "type": "featurelist_item",
        "name": "Feature List Item",
        "settings": [
          {
            "type": "richtext",
            "id": "featurelist_item",
            "label": "Feature List Item",
            "default": "<p>3-layer carbon steel </p>"
          }, {
            "type": "color",
            "id": "featurelist_item_color",
            "label": "Item Color",
            "default": "#000000"
          }, {
            "type": "range",
            "id": "featurelist_item_size",
            "min": 10,
            "max": 50,
            "step": 1,
            "unit": "px",
            "label": "Featurelist Item Size",
            "default": 14
          }
        ]
      }, {
        "type": "addBtn",
        "name": "Add Button Block",
        "settings": [
          {
            "type": "text",
            "id": "btn_text",
            "label": "Button Text",
            "default": "Add to Cart"
          }
        ]
      }, {
        "type": "paymentIcon",
        "name": "Payment Icon Block",
        "settings": [
          {
            "type": "image_picker",
            "id": "payment_img",
            "label": "Payment Icon"
          }
        ]
      }, {
        "type": "productInfo",
        "name": "Product Info Block",
        "settings": [
          {
            "type": "image_picker",
            "id": "info_img_1",
            "label": "Info Image 1"
          },
          {
            "type": "text",
            "id": "info_text_1",
            "label": "Info Text 1",
            "default": "30-day satisfaction guarantee"
          },
          {
            "type": "image_picker",
            "id": "info_img_2",
            "label": "Info Image 2"
          },
          {
            "type": "text",
            "id": "info_text_2",
            "label": "Info Text 2",
            "default": "free shipping from 70€"
          }, {
            "type": "image_picker",
            "id": "info_img_3",
            "label": "Info Image 3"
          }, {
            "type": "text",
            "id": "info_text_3",
            "label": "Info Text 3",
            "default": "1 free grinding service in the first year"
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "APEX Product Infos old"
      }
    ]
  }
{% endschema %}

<script src="{{ 'swiper-bundle.min.js' | asset_url }}"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    let thumbSwiper;
    let mainSwiper;
  
    function initThumbSwiper() {
      let direction = window.innerWidth >= 1100 ? 'vertical' : 'horizontal';
  
      thumbSwiper = new Swiper('.thumb-slider', {
        direction: direction,
        centeredSlides: false,
        slidesPerView: 'auto',
        spaceBetween: 10,
        watchOverflow: true,
        watchSlidesVisibility: true,
        watchSlidesProgress: true,
      });
    }
  
    function initMainSwiper() {
      mainSwiper = new Swiper('.main-slider', {
        spaceBetween: 10,
        navigation: {
          nextEl: '.button-next',
          prevEl: '.button-prev',
        },
        on: {
          slideChange: function () {
            if (thumbSwiper) {
              thumbSwiper.slideTo(mainSwiper.activeIndex);
            }
          },
        },
      });
  
      // Sync the main slider when clicking on a thumbnail
      thumbSwiper.on('click', function (swiper) {
        mainSwiper.slideTo(swiper.clickedIndex);
      });
    }
  
    // Initialize sliders
    initThumbSwiper();
    initMainSwiper();
  });
</script>

{% comment %} sdd to cart script  {% endcomment %}
<script>
  class CartManager {
    constructor(buttonSelector) {
      this.productButtons = document.querySelectorAll(buttonSelector);
      this.init();
    }
  
    // Initialize event listeners
    init() {
      this.productButtons.forEach((button) => {
        button.addEventListener('click', (event) => this.handleAddToCart(event, button));
      });
    }
  
    // Handle the Add to Cart button click
    handleAddToCart(event, button) {
      event.preventDefault();
  
      const productId = button.getAttribute('data-id');
      if (!productId) {
        console.log('Product ID not found!');
        return;
      }
      const cart_drawer = document.querySelector('.m-cart-drawer');
      cart_drawer.classList.add('m-cart-drawer--active');
      console.log(cart_drawer);
      const formData = {
        items: [
          {
            id: parseInt(productId, 10), // Convert the ID to an integer
            quantity: 1, // Default quantity set to 1
          },
        ],
        sections: 'MinimogCartDrawer,main-cart-items,cart-icon-bubble,cart-live-region-text,cart-footer',
      };
  
      this.addToCart(formData);
    }
  
    // Send the add-to-cart request
    async addToCart(formData) {
      try {
        const response = await fetch(window.Shopify.routes.root + 'cart/add.js', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData),
        });
  
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
  
        const data = await response.json();
        console.log('Product added to cart:', data);
        this.updateCartUI(data);
      } catch (error) {
        console.error('Error adding product to cart:', error);
      }
    }
  
    // Update the cart UI dynamically
    updateCartUI(cartData) {
      try {
        const parser = new DOMParser();
  
        // Update the cart icon bubble
        const newCartIconBubble = this.parseHTML(cartData.sections['cart-icon-bubble'], '.cart-count-bubble');
        const currentCartIconBubble = document.querySelector('.cart-count-bubble');
        if (newCartIconBubble && currentCartIconBubble) {
          currentCartIconBubble.innerHTML = newCartIconBubble.innerHTML;
        }
  
        // Update the cart drawer items
        const newCartItem = this.parseHTML(cartData.sections['cart-drawer'], '#CartDrawer-Item-1');
        const currentCartItem = document.querySelector('#CartDrawer-Item-1');
        if (newCartItem && currentCartItem) {
          currentCartItem.innerHTML = newCartItem.innerHTML;
        }
      } catch (error) {
        console.error('Error updating the cart UI:', error);
      }
    }
  
    // Helper method to parse HTML and extract a specific element
    parseHTML(htmlString, selector) {
      const doc = new DOMParser().parseFromString(htmlString, 'text/html');
      return doc.querySelector(selector);
    }
  }
  
  // Instantiate the CartManager with the button selector
  window.addEventListener('DOMContentLoaded', () => {
    new CartManager('.rs-addBtn .rs-add-to-cart');
  });
</script>